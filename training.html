<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>مدرّب الطباعة — كامل الكيبورد</title>
<style>
:root{
  --bg:#f7fafc; 
  --fg:#0f172a; 
  --muted:#64748b; 
  --primary:#0ea5e9;
  --ok:#10b981; 
  --bad:#ef4444; 
  --card:#ffffff; 
  --border:#e5e7eb;
  --shadow:0 6px 24px rgba(2,6,23,.06);
  --highlight:#fffae6; /* لون خلفية للتمرين الحالي */
  --keyboard-key:#ffffff;
  --keyboard-target:#7dd3fc;
}

*{box-sizing:border-box;}
body{
  margin:0;
  font-family:system-ui,Segoe UI,Roboto,Arial;
  min-height:100vh;
  background:linear-gradient(180deg,#f0f9ff,#fff);
  display:flex;
  justify-content:center;
  align-items:center;
  direction:rtl;
  color:var(--fg);
}

.wrap{
  max-width:980px;
  width:100%;
  margin:16px;
  padding:16px;
}

.card{
  background:var(--card);
  border:2px solid var(--border);
  border-radius:50px;
  box-shadow:var(--shadow);
  padding:50px;
}

h1,h2{margin:0;color:#d6458b;}

button, select, input{
  border:2px solid var(--border);
  border-radius:12px;
  padding:10px 14px;
  cursor:pointer;
  font-weight:600;
  transition:all .2s ease;
}

/* تعديل حجم الأزرار فقط — حسب طلبك */
button{
  padding:14px 20px;
  border-radius:16px;
  font-size:20px;
  min-width:120px;
}

button:hover, select:hover, input:hover{
  transform:scale(1.02);
}

button.primary{
  background:linear-gradient(90deg,#7dd3fc,#38bdf8);
  border:none;
  color:#00354a;
}

/* ✅ تعديل 1: تكبير مربع الاسم */ input#userName{ width:95%; font-size:20px; padding:16px; border-radius:16px; }
input{
  width:90%;
  margin:12px auto;
  display:block;
}

.hidden{display:none;}

header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:16px;
  flex-wrap:wrap;
}

.brand{
  display:flex;
  align-items:center;
  gap:12px;
}

.logo{
  width:44px;
  height:44px;
  border-radius:12px;
  background:linear-gradient(45deg,#bae6fd,#7dd3fc);
  display:flex;
  justify-content:center;
  align-items:center;
  font-weight:800;
  font-size:18px;
  color:#00354a;
}

.controls{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}

.grid{
  display:grid;
  grid-template-columns:1.1fr .9fr;
  gap:16px;
}

.exercise{
  padding:16px;
  border:2px dashed #cfe8ff;
  border-radius:12px;
  background:linear-gradient(180deg,#f8fdff,#ffffff);
  min-height:120px;
}

.exercise .big{
  font-family:"Courier New",monospace;
  font-size:22px;
  line-height:2;
  word-break:break-word;
}

.typed-correct{color:var(--ok);}
.typed-current{
  background:var(--highlight);
  border-radius:8px;
  padding:2px 6px;
  font-weight:700;
}
.typed-future{color:var(--muted);}

.stats{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:10px;
  margin-top:14px;
}

.stat{
  background:#fff;
  border:2px solid var(--border);
  border-radius:12px;
  padding:12px;
  text-align:center;
  font-weight:600;
}

.stat strong{display:block;font-size:18px;}

.lesson-card{
  height:100%;
  display:flex;
  flex-direction:column;
  gap:12px;
}

.lesson-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
}

.list{
  background:#fff;
  border:2px solid var(--border);
  border-radius:12px;
  padding:12px;
  max-height:300px;
  overflow:auto;
}

.list-item{
  padding:10px;
  border-radius:12px;
  border:2px solid transparent;
  cursor:pointer;
  margin-bottom:6px;
  transition:all .2s ease;
}

.list-item:hover{
  background:#f0f9ff;
}

.list-item.active{
  border-color:#38bdf8;
  background:#d0f0ff;
}

.kb{
  margin-top:16px;
}

.kb-row{
  display:flex;
  justify-content:center;
  gap:6px;
  margin-bottom:8px;
}

.kb-key{
  min-width:40px;
  height:40px;
  padding:8px;
  border-radius:10px;
  background:var(--keyboard-key);
  border:2px solid var(--border);
  text-align:center;
  font-weight:700;
  display:flex;
  justify-content:center;
  align-items:center;
  transition:all .2s ease;
}

.kb-key.target{
  outline:3px solid rgba(14,165,233,.4);
  box-shadow:0 6px 16px rgba(14,165,233,.25);
  background:var(--keyboard-target);
  color:#fff;
  font-weight:800;
}

.motivation{
  margin-top:20px;
  font-size:16px;
  font-weight:bold;
  color:#333;
  background:#fffae6;
  padding:12px;
  border-radius:12px;
  text-align:center;
}


@media(max-width:900px){
  .grid{grid-template-columns:1fr;}
  .stats{grid-template-columns:repeat(2,1fr);}
}
</style>

</head>
<body>
<div class="wrap">

<!-- شاشة البداية -->
<div id="startPage" class="card">
<h1>💻 مرحباً بك في مدرّب الطباعة</h1>
<p>ادخل اسمك للبدء:</p>
<input id="userName" placeholder="أدخل اسمك هنا...">
<button id="btnStart" class="primary">ابدأ</button>
<div class="motivation">✨ كل يوم تتقدم أكثر في الطباعة! 🚀</div>
</div>

<!-- صفحة اختيار الصف -->
<div id="menuPage" class="card hidden">
<h2>اختر الصف للتدريب</h2>
<div class="controls">
<button class="primary" data-page="home">🏠 Home Row</button>
<button class="primary" data-page="top">🔝 Top Row</button>
<button class="primary" data-page="bottom">🔽 Bottom Row</button>
</div>
<div class="motivation">💡 التمرين المستمر يجعلك أسرع وأكثر دقة!</div>
</div>

<!-- صفحة التدريب -->
<div id="trainerPage" class="card hidden">
<header>
<div class="brand"><div class="logo">TT</div><div><h1 id="lessonTitle">الدرس</h1></div></div>
<div class="controls">
<button id="btnPrev">◀ الدرس السابق</button>
<button id="btnNext" class="primary">الدرس التالي ▶</button>
<button id="btnRestart">🔄 إعادة التمرين</button>
</div>
</header>
    <!-- input مخفي عشان يفتح كيبورد الموبايل -->
    <input id="hiddenInput" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"
           style="opacity:0; position:absolute; top:-1000px;">

<div class="grid">
<div>
<div class="exercise">
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
<div id="drillInfo">تمرين 1 / 4</div>
</div>
<div id="display" class="big" aria-live="polite"></div>
</div>

<div class="stats">
<div class="stat"><div style="color:var(--muted)">السرعة (WPM)</div><strong id="wpm">0.0</strong></div>
<div class="stat"><div style="color:var(--muted)">الدقّة %</div><strong id="acc">100</strong></div>
<div class="stat"><div style="color:var(--muted)">الأخطاء</div><strong id="err">0</strong></div>
<div class="stat"><div style="color:var(--muted)">الوقت (دقيقة)</div><strong id="mins">0.00</strong></div>
</div>
<div class="kb" id="kb"></div>
</div>

<div class="lesson-card">
<div class="lesson-head">
<div style="font-weight:800">خطة الدروس</div>
<select id="lessonSelect"></select>
</div>
<div class="list" id="drillList"></div>
<div style="font-size:13px;color:var(--muted)">ملاحظة: اكتب من لوحة المفاتيح الحقيقية. الحرف الحالي ملوّن بخلفية صفراء. الإحصائيات تحدث مباشرة.</div>
</div>
</div>
</div>

</div>

<script>
  function saveProgress(name, lesson, acc, wpm, err) {
  console.log("🚀 تم حفظ التقدّم:");
  console.log("الاسم:", name);
  console.log("الدرس:", lesson);
  console.log("الدقّة:", acc);
  console.log("السرعة:", wpm);
  console.log("الأخطاء:", err);
  // هون تقدر تبني كود تخزين فعلي (localStorage أو قاعدة بيانات)
}

// --- الدروس لكل صف ---  


const LESSONS_DATA = { 
  home:[
    {title:'F & J', drills:['ffffffjjjjjj','f f f   j j j','fj fj fj   jf jf jf','fff jjj fff jjj fjfj fjfj fjjf jffj fjjf fj fj fj ff jj fj jf jf jf ffjj jjff fjfj ff jj ff jj fj jf fj jf ffjj jjff fjf jfjf fjfj fjfj'], keyboard:['a','s','d','f','g','h','j','k','l',';']},
    {title:'D & K', drills:['d d d   k k k','dk dk dk   kd kd kd','dd kk dd kk dk kd dk kd ddd kkk dkdk kdkd dk dk dk kd kd ddkk kkdd dkdk dkdk dddk ddkk kkdd dkdk dkdk dk kd dk kd ddd kkk ddk '], keyboard:['a','s','d','f','g','h','j','k','l',';']},
    {title:'f-D & J-K', drills:['kfj dfd jfj kfk djf',' dfkj  jfkd kkkd fjjf dkfj jdfk kjff dkjf  fjkd dkff jjkd fjdf kfjk djkf   fkjd','jjff kdkf djfj ffkd kjdf jfkj ddkj fjff kfjd jdkj fjkk djff jfkd kd df fjjf kkfj jfjk dfkj fjkd jkjf kjff  jddk fjjf kfkf dkjf jffk fjjd kdfj kjjk fjfj '], keyboard:['a','s','d','f','g','h','j','k','l',';']},

    {title:'S & L', drills:['s s s   l l l','sl sl sl   ls ls ls','ss ll ss ll sl ls sl ls sss lll slsl llsl sl sl sl ls ls llll llss slsl slsl sssl  llsl ssll ssss slsl slsl ssll  ssl lss ssl lss slsl slsl'], keyboard:['a','s','d','f','g','h','j','k','l',';']},
    {title:'A & ;', drills:['aa ;; aa ;; a;a ;a; a;a; aaa ;;; a;a; ;a;a','aa;; ;;aa a;a; a;a; aaa; ;;aa a; a; a; ;a ;a','a;a; ;a;a aa;; ;;aa aaa ;;; a;a; ;a;a a;a; ;a;a aa;; ;;aa aaa ;;; a;a; ;a;a'], keyboard:['a','s','d','f','g','h','j','k','l',';']},
    {title:'G & H', drills:['gg hh gg hh gh hg gh hg ggg hhh ghgh hghg','gh gh gh hg hg gghh hhgg ghgh ghgh gggg hhhh','ghgg ghgh hh hg gh hg gghh hhgg ghgh ghgh','ggh hgg ggh hgg ghgh hhgh gghh hhhg gghh'], keyboard:['a','s','d','f','g','h','j','k','l',';']},
    {title:'كلمات من الحروف', drills:['sad; lad all fa;ll ask alas salsa had; dash shall',';had dash shall','fad ;; gala sall half salad shall flak hall lass','lad s;ag hall ;gall salad fall lass hall gag lad sag hall; gall salad fall lass hall gag;'], keyboard:['a','s','d','f','g','h','j','k','l',';']}
  ],
  //
  top:[ 
    {title:'R & U', 
drills:[
  'rrrrr uuuuu rrrr uuuu rr uu rr uu ru ur ru ur rrr uu rr uu ru ur ru ur ru ur rr uu rr uu ru ur  ruur  rrrrr uuuuu',
  'fjur ru  ur ur ru rrff juur juuu jrfu ru ur ur ru rfjur ur ur ru ru ur rrr jjj fff uuu ruurr uuurr uu uur rfruj uuru',
  'rr jfur urfj rfju jrru frjuu ffruj jjur fjur furj  uu ru ur ru ur rr uu rrrr  uu ru ur  ruur  rrrrr uuuuu\n rrrr uuuu ru jjju uuuj fffr \nru urur ru ru rrrf ru ru uruu jrfu'
], 
keyboard:['q','w','e','r','t','y','u','i','o','p'],
},


{title:'E & I', 
drills:[
  'eeeee iiiii eeee iiii ee ii ee ii ei ie \nei ie eee ii ee ii ei ie ei ie',
  'ei ei ie ie ei ie eii e ei ie   ie ei ei ie iee ei ie ei ie ei ie ie ei ei ie ie ei ei',
  'ee ii ee ii ei ie ei ie ee ii ee ii ei ie ei ie ee ii ee ii ei ie ei ie iieii  eeeiee'
], 
keyboard:['q','w','e','r','t','y','u','i','o','p']},

{title:'W & O', 
drills:[
  'wwwww ooooo wwww oooo ww oo ww oo wo ow wo ow www oo ww oo wo ow wo ow',
  'wo wo ow ow wo ow wo ow wo ow wo ow wo ow woow',
  'ww oo ww oo wo ow wo ow ww oo ww oo wo ow wo   ow ww oo ww oo wo ow wo ow wwww ooooo wwww Woooo ww oo ww oo wo ow wo ow www oo ww'
], 
keyboard:['q','w','e','r','t','y','u','i','o','p']},

{title:'Q & P', 
drills:[
  'qqqqq ppppp qqqq pppp qq pp qq pp qp pq qpp   q qqq pp qq pp qp pq qp p q',
  'q p qp pq pq qp pq qp pqqp pq qp pq qp pq qp pq',
  'qq pp qq pp qp pq qp pq qq pp qq pp qp pq qp pq qq pp qq ppqp pq qp pqppppp  qqqq pppp qq pp qq pp qp pq qp pq qqq pp qq pp qp'
], 
keyboard:['q','w','e','r','t','y','u','i','o','p']},

{title:'T & Y', 
drills:[
  'ttttt yyyyy tttt   yyyy tt yy tt yy ty yt ty yt ttt yy  tt yy  ty  yt tyyt'  ,
  'tyty yty tty yt ty yt ty yt ty yt ty yt ty yt  ',
  'tt yy tt yy ty ytty yt tt  yy ttyy ty yt ty  yt tt yy tt yy ty yt tyyt tty   yt ty yt ty yt ty yt ty '
], 
keyboard:['q','w','e','r','t','y','u','i','o','p']},

{title:'كلمات من الحروف', 
drills:[
  'quit pure tie pie ripe true quip queue quit pure tie pie ripe true quip',
  'queue quip ripe true tie pure quite pie ripe tie pure queue quip ripe',
  'tie ripe pure quite quit pie true quip queue ripe pure tie pie ripe true'
], 
keyboard:['q','w','e','r','t','y','u','i','o','p']}

  ],
  
bottom:[

{title:'V & M', 
drills:[
  'v v v   m m m v v v   m m m v v v   m m m vv mm vv mm vm mv vm mv vv mm vm vm mv mv vv mm vv mm vm mv vm mv',
  'vm vm mv mv vm vm mv vm vm vm mv mv vm vm mv vm vm vm mv mv vm vm mv vm vm vm mv mv vm vm mv vm vm vm mv mv',
  'vv mm vv mm vm mv vm mv vv mm vm vm mv mv vv mm vm vm mv mv vv mm vv mm vm mv vm mv vv mm vm vm mv mv'
], 
keyboard:['z','x','c','v','b','n','m',',','.','/']},  

{title:'C & ,', drills:['c c c   , , , c c c   , , , c c c   , , , cc ,, cc ,, c, ,c c, ,c cc ,, cc ,, c, ,c c, ,c','c, c, ,c ,c ,c c, c, ,c ,c ,c c, c, ,c ,c ,c c, c, ,c ,c ,c c, c, ,c ,c ,c','cc ,, cc ,, c, ,c c, ,c cc ,, cc ,, c, ,c c, ,c cc ,, cc ,, c, ,c c, ,c'], 
keyboard:['z','x','c','v','b','n','m',',','.','/']},  

{title:'X & .', 
drills:[
  'x x x   . . . x x x   . . . x x x   . . . xx .. xx .. x. .x x. \n .x xx .. xx .. x. .x x. .x',
  'x. x. .x .x .x x. x. .x .x .x x. x. .x .x .x x. x. .x .x .x',
  'xx .. xx .. x. .x x. .x xx .. xx .. x. .x x. .x xx .. xx .. x. .x x. .x'
], 
keyboard:['z','x','c','v','b','n','m',',','.','/']},  

{title:'Z & /', 
drills:[
  'z z z   / / / z z z   / / / z z z   / / / zz // zz // z/ /z z/ /z zz // zz // z/ /z z/ /z',
  'z/ z/ /z /z /z z/ z/ /z /z /z z/ z/ /z /z /z z/ z/ /z /z /z',
  'zz // zz // z/ /z z/ /z zz // zz // z/ /z z/ /z zz // zz // z/ /z z/ /z'
], 
keyboard:['z','x','c','v','b','n','m',',','.','/']},  

{title:'B & N', 
drills:[
  'b b b   n n n b b b   n n n b b b   n n n bb nn bb nn bn nb bn nb bb nn bb nn bn nb bn nb',
  'bn bn nb nb nb bn bn nb nb nb bn bn nb nb nb bn bn nb nb nb bn bn nb nb nb',
  'bb nn bb nn bn nb bn nb bb nn bb nn bn nb bn nb bb nn bb nn bn nb bn nb'
], 
keyboard:['z','x','c','v','b','n','m',',','.','/']},  

{title:'كلمات من الحروف', 
drills:['cab ban// van bag can, nab cab ban, van.. bag can na,b cab b,an van bag can nab','ca.b van bag, can nab cab ban van .,B //M bag can nab cab van bag can nab c//ab ban',  'cab ba/g can nab cab ban van bag ca./n nab cab bag can nab cab ban van. bag ../,'
], 
keyboard:['z','x','c','v','b','n','m',',','.','/']}

]

};


  // عناصر الصفحة
  const startPage = document.getElementById('startPage');
  const menuPage = document.getElementById('menuPage');
  const trainerPage = document.getElementById('trainerPage');
  const btnStart = document.getElementById('btnStart');
  const userName = document.getElementById('userName');
  const lessonTitle = document.getElementById('lessonTitle');
  const drillInfo = document.getElementById('drillInfo');
  const display = document.getElementById('display');
  const wpmEl = document.getElementById('wpm');
  const accEl = document.getElementById('acc');
  const errEl = document.getElementById('err');
  const minsEl = document.getElementById('mins');
  const kb = document.getElementById('kb');
  const lessonSelect = document.getElementById('lessonSelect');
  const drillList = document.getElementById('drillList');
  const btnPrev = document.getElementById('btnPrev');
  const btnNext = document.getElementById('btnNext');
  const btnRestart = document.getElementById('btnRestart');
  const pageButtons = menuPage.querySelectorAll('button[data-page]');

  let currentPage='home', currentLesson=0, currentDrill=0;
  let text='', cursor=0, total=0, correct=0, mistakes=0, startedAt=null, endedAt=null;

  // --- وظائف مساعدة ---
  function esc(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/ /g,'&nbsp;');}
  function normalize(x){return (x||'').toString().toLowerCase();}
  function renderLine(){
    const left=esc(text.slice(0,cursor));
    const cur=esc(text[cursor]||'✓');
    const right=esc(text.slice(cursor+1));
    display.innerHTML=`<span class="typed-correct">${left}</span>`+
      `<span class="typed-current">${cur}</span>`+
      `<span class="typed-future">${right}</span>`;
    renderKeyboard(text[cursor]||'');
  }
  function stats(){
    const now=endedAt||Date.now();
    const ms=Math.max(1, now-(startedAt||now));
    const minutes=ms/60000;
    const netWPM=((correct/5)/minutes)||0;
    const accuracy=total?((correct/total)*100):100;
    return {netWPM, accuracy, minutes};
  }
  function updateStats(){
    const s=stats();
    wpmEl.textContent=s.netWPM.toFixed(1);
    accEl.textContent=s.accuracy.toFixed(1);
    errEl.textContent=mistakes;
    minsEl.textContent=s.minutes.toFixed(2);
  }
  function renderKeyboard(targetChar=''){
    let keys=[];
    if(currentPage==='home') keys=['a','s','d','f','g','h','j','k','l',';'];
    if(currentPage==='top') keys=['q','w','e','r','t','y','u','i','o','p'] ;
    if(currentPage==='bottom') keys=['z','x','c','v','b','n','m',',','.','/'];
    kb.innerHTML='';
    const row=document.createElement('div');row.className='kb-row';
    keys.forEach(k=>{
      const el=document.createElement('div');
      el.className='kb-key'; el.textContent=k;
      if(normalize(k)===normalize(targetChar)) el.classList.add('target');
      row.appendChild(el);
    });
    kb.appendChild(row);
  }

  // --- تحميل الدرس ---
  function loadLesson(idx){
    const lessons=LESSONS_DATA[currentPage];
    currentLesson=Math.max(0,Math.min(lessons.length-1,idx));
    populateLessonSelect();
    lessonTitle.textContent=lessons[currentLesson].title;
    populateDrillList();
    loadDrill(0);
  }
  function populateLessonSelect(){
    lessonSelect.innerHTML='';
    const lessons=LESSONS_DATA[currentPage];
    lessons.forEach((l,i)=>{
      const opt=document.createElement('option');
      opt.value=i; opt.textContent=`${i+1}) ${l.title}`;
      if(i===currentLesson) opt.selected=true;
      lessonSelect.appendChild(opt);
    });
  }
  function populateDrillList(){
    drillList.innerHTML='';
    const drills=LESSONS_DATA[currentPage][currentLesson].drills;
    drills.forEach((d,i)=>{
      const item=document.createElement('div');
      item.className='list-item'+(i===currentDrill?' active':'');
      item.textContent=`تمرين ${i+1}`;
      item.addEventListener('click',()=>loadDrill(i));
      drillList.appendChild(item);
    });
  }
  function loadDrill(i){
    const drills=LESSONS_DATA[currentPage][currentLesson].drills;
    currentDrill=Math.max(0,Math.min(drills.length-1,i));
    drillInfo.textContent=`تمرين ${currentDrill+1} / ${drills.length}`;
    text=drills[currentDrill];
    cursor=0; total=0; correct=0; mistakes=0; startedAt=null; endedAt=null;
    renderLine(); updateStats();
    highlightActiveDrill();
  }
  function highlightActiveDrill(){[...drillList.children].forEach((el,idx)=>el.classList.toggle('active',idx===currentDrill));}

  // --- التعامل مع لوحة المفاتيح ---
  window.addEventListener('keydown',(e)=>{
    if(['Shift','Alt','Control','Meta','CapsLock','Tab'].includes(e.key)) return;
    if(!text) return;
    if(!startedAt) startedAt=Date.now();
    total++;
    const expected=text[cursor]||null;
    const pressed=(e.key==='Enter'?'\n':e.key===' '? ' ': e.key);
    if(normalize(pressed)===normalize(expected)){ 
      correct++; cursor++;
      if(cursor>=text.length){
        endedAt=Date.now(); renderLine(); updateStats();
        
        // 🟢 حفظ التقدم عند انتهاء التمرين
        const s = stats();
        saveProgress(
          userName.value, 
          LESSONS_DATA[currentPage][currentLesson].title, 
          s.accuracy.toFixed(1), 
          s.netWPM.toFixed(1), 
          mistakes
        );
        // دالة لحفظ النتيجة بعد انتهاء التدريب
function saveProgress(username, lesson, accuracy, speed, errors) {
  let progress = JSON.parse(localStorage.getItem("progress")) || [];

  progress.push({
    username: username,
    lesson: lesson,
    accuracy: accuracy,
    speed: speed,
    errors: errors,
    date: new Date().toLocaleString()
  });

  localStorage.setItem("progress", JSON.stringify(progress));
}

// دالة لعرض النتائج في صفحة التقدم
function showProgress() {
  let progress = JSON.parse(localStorage.getItem("progress")) || [];
  let table = document.getElementById("progressTable");

  table.innerHTML = `
    <tr>
      <th>👤 الاسم</th>
      <th>📖 الدرس</th>
      <th>✅ الدقة</th>
      <th>⚡ السرعة</th>
      <th>❌ الأخطاء</th>
      <th>🗓️ التاريخ</th>
    </tr>
  `;

  progress.forEach(p => {
    table.innerHTML += `
      <tr>
        <td>${p.username}</td>
        <td>${p.lesson}</td>
        <td>${p.accuracy}%</td>
        <td>${p.speed} WPM</td>
        <td>${p.errors}</td>
        <td>${p.date}</td>
      </tr>
    `;
  });
}

// مثال: استدعاء الحفظ (لما يخلص الطالب تمرين)
function finishLesson() {
  let username = document.getElementById("username").value || "طالب";
  let lesson = "الدرس 1";
  let accuracy = document.getElementById("acc").innerText;
  let speed = document.getElementById("wpm").innerText;
  let errors = document.getElementById("err").innerText;

  saveProgress(username, lesson, accuracy, speed, errors);
  alert("تم حفظ التقدّم ✅");
}
        
        flashDone(); // ✔ التكريم
        setTimeout(()=>{
          const drills=LESSONS_DATA[currentPage][currentLesson].drills;
          if(currentDrill<drills.length-1) loadDrill(currentDrill+1);
        },250);
        return;
      }
    } else {mistakes++; flashError();}
    renderLine(); updateStats();
  });

  function flashError(){
    display.style.transition='transform .08s';
    display.style.transform='translateY(-6px)';
    setTimeout(()=>display.style.transform='translateY(0)',90);
  }
  function flashDone(){
    const old=lessonTitle.textContent;
    lessonTitle.textContent=old+' — 🎉 ✔ أحسنت!';
    setTimeout(()=>{lessonTitle.textContent=old;},1500);
  }

  // --- أزرار التحكم ---
  btnRestart.addEventListener('click',()=>loadDrill(currentDrill));
  btnPrev.addEventListener('click',()=>loadLesson(currentLesson-1));
  btnNext.addEventListener('click',()=>loadLesson(currentLesson+1));
  lessonSelect.addEventListener('change',(e)=>loadLesson(parseInt(e.target.value,10)||0));

  // --- أزرار اختيار الصف ---
  btnStart.addEventListener('click',()=>{
    if(!userName.value.trim()){alert('⚠️ الرجاء إدخال اسمك أولاً'); return;}
    startPage.classList.add('hidden'); menuPage.classList.remove('hidden');
  });
  pageButtons.forEach(btn=>btn.addEventListener('click',(e)=>{
    currentPage=btn.dataset.page;
    menuPage.classList.add('hidden'); trainerPage.classList.remove('hidden');
    loadLesson(0);
  }));

const hiddenInput = document.getElementById('hiddenInput');
let typed = "";

hiddenInput.addEventListener('input', (e) => {
    if(!text) return;
    if(!startedAt) startedAt = Date.now();

    const value = hiddenInput.value;
    const newChar = value[value.length - 1];
    if(!newChar) return;

    typed += newChar;
    total++;
    const expected = text[cursor] || null;
    const pressed = (newChar === '\n' ? '\n' : newChar);

    if(normalize(pressed) === normalize(expected)){
        correct++;
        cursor++;
        if(cursor >= text.length){
            endedAt = Date.now();
            renderLine();
            updateStats();

            const s = stats();
            saveProgress(
                userName.value, 
                LESSONS_DATA[currentPage][currentLesson].title, 
                s.accuracy.toFixed(1), 
                s.netWPM.toFixed(1), 
                mistakes
            );
        }
    } else {
        mistakes.push({expected, pressed, pos: cursor});
    }

    renderLine();
    updateStats();
    hiddenInput.value = "";
});

 
</script>
</body>
</html>
